# Code Reviewer 参考文档

## API 参考

### reviewCode(code, options)

审查代码并返回审查报告

**参数：**
- `code` (String)：要审查的代码内容
- `options` (Object)：配置选项
  - `language` (String)：代码语言
  - `focus` (Array)：审查重点
  - `severityThreshold` (String)：严重程度阈值
  - `maxIssues` (Number)：最大问题数量

**返回值：**
- `Object`：审查报告对象
  - `summary` (Object)：审查摘要
  - `issues` (Array)：问题列表
  - `suggestions` (Array)：建议列表

**示例：**
```javascript
const code = `function getUserData(userId) {
  const query = \`SELECT * FROM users WHERE id = ${userId}\`;
  return db.execute(query);
}`;

const options = {
  language: 'javascript',
  focus: ['security', 'correctness'],
  severityThreshold: 'medium',
  maxIssues: 10
};

const report = await reviewCode(code, options);
console.log(report);
```

### fixCode(code, issues)

自动修复代码中的问题

**参数：**
- `code` (String)：原始代码
- `issues` (Array)：要修复的问题列表

**返回值：**
- `String`：修复后的代码

**示例：**
```javascript
const code = `function getUserData(userId) {
  const query = \`SELECT * FROM users WHERE id = ${userId}\`;
  return db.execute(query);
}`;

const issues = [
  {
    type: 'sql_injection',
    line: 2,
    column: 15
  }
];

const fixedCode = await fixCode(code, issues);
console.log(fixedCode);
```

### getBestPractices(language, category)

获取指定语言和类别的最佳实践

**参数：**
- `language` (String)：编程语言
- `category` (String)：类别（security/performance/maintainability等）

**返回值：**
- `Array`：最佳实践列表

**示例：**
```javascript
const practices = await getBestPractices('javascript', 'security');
console.log(practices);
```

## 审查类型参考

### 1. 安全性审查

#### SQL 注入
- **描述**：检查是否存在 SQL 注入漏洞
- **严重程度**：高
- **检查方法**：识别字符串拼接的 SQL 查询
- **修复方法**：使用参数化查询

#### XSS 攻击
- **描述**：检查是否存在跨站脚本攻击漏洞
- **严重程度**：高
- **检查方法**：识别未转义的用户输入
- **修复方法**：对用户输入进行适当的转义

#### 命令注入
- **描述**：检查是否存在命令注入漏洞
- **严重程度**：高
- **检查方法**：识别使用用户输入构建的系统命令
- **修复方法**：避免使用用户输入构建系统命令

#### 敏感信息泄露
- **描述**：检查是否存在敏感信息泄露
- **严重程度**：中
- **检查方法**：识别硬编码的密码、API 密钥等
- **修复方法**：使用环境变量或配置文件存储敏感信息

### 2. 性能审查

#### 时间复杂度优化
- **描述**：检查算法的时间复杂度
- **严重程度**：中
- **检查方法**：识别嵌套循环、递归调用等
- **修复方法**：优化算法，降低时间复杂度

#### 空间复杂度优化
- **描述**：检查算法的空间复杂度
- **严重程度**：中
- **检查方法**：识别不必要的内存分配
- **修复方法**：优化数据结构，减少内存使用

#### 数据库查询优化
- **描述**：检查数据库查询性能
- **严重程度**：中
- **检查方法**：识别缺少索引的查询、N+1 查询等
- **修复方法**：添加适当的索引，优化查询语句

### 3. 可维护性审查

#### 代码重复
- **描述**：检查是否存在代码重复
- **严重程度**：低
- **检查方法**：识别相似的代码块
- **修复方法**：提取公共函数或模块

#### 函数复杂度
- **描述**：检查函数的复杂度
- **严重程度**：低
- **检查方法**：计算函数的圈复杂度
- **修复方法**：拆分复杂函数，提高可读性

#### 命名规范
- **描述**：检查变量、函数、类的命名
- **严重程度**：低
- **检查方法**：识别不规范的命名
- **修复方法**：使用有意义的命名

#### 注释质量
- **描述**：检查代码注释的质量
- **严重程度**：低
- **检查方法**：识别缺少注释或注释不清晰的代码
- **修复方法**：添加适当的注释

### 4. 正确性审查

#### 逻辑错误
- **描述**：检查代码逻辑是否正确
- **严重程度**：高
- **检查方法**：识别逻辑矛盾、边界条件处理不当等
- **修复方法**：修复逻辑错误，完善边界条件处理

#### 类型错误
- **描述**：检查类型使用是否正确
- **严重程度**：中
- **检查方法**：识别类型不匹配、类型转换错误等
- **修复方法**：使用正确的类型，添加类型检查

#### 空值处理
- **描述**：检查空值处理是否正确
- **严重程度**：中
- **检查方法**：识别缺少空值检查的代码
- **修复方法**：添加适当的空值检查

## 严重程度参考

### 高严重程度
- 可能导致系统崩溃
- 可能导致数据丢失或损坏
- 可能导致安全漏洞
- 可能导致严重的性能问题

### 中严重程度
- 可能导致功能异常
- 可能导致资源泄漏
- 可能导致代码难以维护
- 可能导致中等性能问题

### 低严重程度
- 代码风格问题
- 命名不规范
- 缺少注释
- 轻微的性能问题

## 最佳实践

### 1. 安全性最佳实践

#### SQL 注入防护
- 始终使用参数化查询
- 避免使用字符串拼接构建 SQL 查询
- 对用户输入进行验证和过滤
- 使用最小权限原则配置数据库用户

#### XSS 防护
- 对用户输入进行适当的转义
- 使用安全的输出方法
- 设置适当的 HTTP 头（如 Content-Security-Policy）
- 使用安全的 JavaScript 框架

#### 命令注入防护
- 避免使用用户输入构建系统命令
- 如果必须使用，对输入进行严格的验证
- 使用白名单机制限制允许的输入
- 使用安全的 API 替代系统命令

### 2. 性能最佳实践

#### 算法优化
- 使用适当的算法和数据结构
- 避免不必要的计算
- 缓存计算结果
- 并行处理独立任务

#### 数据库优化
- 添加适当的索引
- 优化查询语句
- 避免 N+1 查询问题
- 使用连接池管理数据库连接

#### 内存优化
- 避免不必要的内存分配
- 及时释放不再使用的资源
- 使用适当的数据结构
- 避免内存泄漏

### 3. 可维护性最佳实践

#### 代码结构
- 保持函数和类的单一职责
- 避免过度设计
- 使用适当的设计模式
- 保持代码简洁

#### 命名规范
- 使用有意义的变量名
- 使用一致的命名风格
- 避免使用缩写和简写
- 使用描述性的函数名

#### 注释规范
- 为复杂的逻辑添加注释
- 为公共 API 添加文档注释
- 保持注释与代码同步
- 避免冗余的注释

#### 测试规范
- 编写单元测试
- 编写集成测试
- 保持测试覆盖率
- 测试边界条件

## 常见问题

### Q: 代码审查需要多长时间？
A: 代码审查的时间取决于代码的复杂度和审查的深度。一般来说，100 行左右的代码需要 5-10 分钟。

### Q: 如何提高代码审查的效率？
A: 建议：
1. 分批次提交代码，每次提交的代码量不宜过大
2. 编写清晰的提交信息
3. 提前进行自我审查
4. 使用自动化工具进行初步检查

### Q: 代码审查会影响开发进度吗？
A: 适当的代码审查不会影响开发进度，反而可以提高代码质量，减少后续的维护成本。

### Q: 如何处理代码审查中的分歧？
A: 建议：
1. 保持开放的心态，听取他人的意见
2. 用事实和数据支持自己的观点
3. 寻求第三方的意见
4. 如果无法达成一致，可以暂时搁置，后续再讨论

### Q: 代码审查应该由谁来进行？
A: 代码审查应该由团队中的其他成员进行，最好是有相关经验的开发人员。

## 版本历史

### v1.2.0 (2026-01-04)
- 优化性能评估算法
- 增加自动修复功能
- 改进审查报告格式

### v1.1.0 (2026-01-03)
- 增加安全性审查功能
- 优化问题检测算法
- 修复已知问题

### v1.0.0 (2026-01-02)
- 初始版本
- 支持基本代码审查
- 支持多种编程语言
